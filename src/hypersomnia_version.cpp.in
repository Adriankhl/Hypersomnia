/*
	timestamp: %x
	argc: %x
	argv: %x*/

#include "hypersomnia_version.h"

#if WAS_VERSION_GENERATOR_BUILT
#include "augs/misc/typesafe_sprintf.h"

hypersomnia_version::hypersomnia_version() :
	commit_number(%x),
	commit_message("%x"),
	commit_date("%x"),
	commit_hash("%x"),
	working_tree_changes({
%x	})
{
}

std::string hypersomnia_version::get_summary() const {
	return typesafe_sprintf(
		"Revision no.: %x %x\n"
		"Build date: %x\n"
		"Commit message:\n%x\n"
		"Compilation flags:\n"
		"STATICALLY_ALLOCATE_ENTITIES_NUM=%x\n"
		"STATICALLY_ALLOCATE_ASSETS=%x\n"
		"STATICALLY_ALLOCATE_BAKED_FONTS=%x\n"
		"wchar_t size=%x\n",
		commit_number ? std::to_string(commit_number) : "Unknown",
		commit_number ? working_tree_changes.empty() ? "(clean)" : "(dirty)" : "",
		commit_date,
		commit_message.size() < 30 ? commit_message : commit_message.substr(0, 30) + "(...)",
		STATICALLY_ALLOCATE_ENTITIES_NUM,
		STATICALLY_ALLOCATE_ASSETS,
		STATICALLY_ALLOCATE_BAKED_FONTS,
		sizeof(wchar_t)
	);
}

#else

hypersomnia_version::hypersomnia_version() :
	commit_number(0),
	commit_message("Unknown"),
	commit_date("Unknown"),
	commit_hash("Unknown"),
	working_tree_changes({})
{
}

std::string hypersomnia_version::get_summary() const {
	return "Unknown revision.\nVersion file generator was excluded from build.";
}

#endif
